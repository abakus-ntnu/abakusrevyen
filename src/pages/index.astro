---
import Countdown from "@/layouts/Home/Countdown.astro";
import Live from "@/layouts/Home/Live.astro";
import Break from "@/layouts/Home/Break.astro";
import Recruitment from "@/layouts/Home/Recruitment.astro";

import {
  RECRUITMENT_START,
  RECRUITMENT_END,
  COUNTDOWN_START,
  SHOW_START,
  SHOW_END,
} from "@/lib/constants";

type Period = "recruitment" | "showStarting" | "showCurrent" | "break";

const periods: { from: Date; period: Period }[] = [
  { from: RECRUITMENT_START, period: "recruitment" },
  { from: RECRUITMENT_END, period: "break" },
  { from: COUNTDOWN_START, period: "showStarting" },
  { from: SHOW_START, period: "showCurrent" },
  { from: SHOW_END, period: "break" },
];

function getCurrentPeriod(override: Period | undefined = undefined): Period {
  if (override) {
    return override;
  }

  let now = new Date();

  for (let period of periods.slice().reverse()) {
    if (period.from <= now) {
      return period.period;
    }
  }

  return "break";
}

const period = getCurrentPeriod("showStarting");
---

{
  period == "break" ? (
    <Break />
  ) : period == "recruitment" ? (
    <Recruitment />
  ) : period == "showCurrent" ? (
    <Live />
  ) : (
    <Countdown date={SHOW_START} />
  )
}
