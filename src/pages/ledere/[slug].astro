---
import ArticleLayout from "@/layouts/ArticleLayout.astro";

import { Image } from "astro:assets";
import { getEntries } from "astro:content";
import {
  getEntry,
  render,
  getCollection,
  type ValidContentEntrySlug,
} from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("ledere");
  const list = entries.map((entry) => ({ params: { slug: entry.slug } }));
  return list;
}

const { slug }: { slug: ValidContentEntrySlug<"ledere"> } = Astro.params;

const entry = await getEntry("ledere", slug);
const { name, image, leaderOf } = entry.data;

const groups = await getEntries(leaderOf.map((ref) => ref.group));

function getGroup(groupRef: {
  collection: "grupper";
  slug: ValidContentEntrySlug<"grupper">;
}) {
  return groups.find((group) => group.slug === groupRef.slug);
}

const alt = leaderOf
  .map((ref) => `${ref.title} of ${getGroup(ref.group)?.data.name}`)
  .join(", ");

const { Content } = await render(entry);
---

<ArticleLayout title={name}>
  <img
    src={image}
    width="auto"
    height="auto"
    alt={alt}
    class="rounded-lg w-56"
  />
  <Content />
</ArticleLayout>
